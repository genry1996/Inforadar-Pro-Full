<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ event_name }} - Match Details | Inforadar Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f7fa;
            color: #202733;
            min-height: 100vh;
        }

        .ir-header {
            background: #ffffff;
            border-bottom: 1px solid #e6ebf0;
            padding: 0 40px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .ir-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 700;
            color: #202733;
            text-decoration: none;
        }

        .ir-logo::before {
            content: 'üî¥';
            font-size: 24px;
        }

        .ir-nav {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .ir-nav a {
            text-decoration: none;
            color: #6b7380;
            font-size: 15px;
            font-weight: 500;
        }

        .back-link {
            color: #00d4ff;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 40px;
        }

        .match-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .match-league {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #202733;
            margin-bottom: 15px;
        }

        .match-teams {
            font-size: 28px;
            font-weight: 700;
            color: #202733;
            margin-bottom: 15px;
        }

        .match-progress {
            max-width: 600px;
            margin: 0 auto 20px;
            height: 30px;
            background: #e6ebf0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .match-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 13px;
            transition: width 0.3s;
        }

        .match-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .btn-toggle {
            padding: 8px 20px;
            border: none;
            background: #e6ebf0;
            color: #6b7380;
            font-weight: 600;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-toggle.active {
            background: #4caf50;
            color: white;
        }

        .btn-toggle:hover {
            background: #d0d6dd;
        }

        .btn-toggle.active:hover {
            background: #45a049;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .odds-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .odds-card-header {
            background: #4caf50;
            color: white;
            padding: 12px 16px;
            font-weight: 700;
            font-size: 15px;
            text-align: center;
        }

        .odds-table {
            width: 100%;
            border-collapse: collapse;
        }

        .odds-table thead {
            background: #f5f7fa;
        }

        .odds-table th {
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            color: #6b7380;
            border-bottom: 1px solid #e6ebf0;
        }

        .odds-table td {
            padding: 12px 8px;
            text-align: center;
            font-size: 13px;
            color: #202733;
            border-bottom: 1px solid #f0f2f5;
        }

        .odds-table tbody tr:hover {
            background: #f9fafb;
        }

        .odds-table tbody tr:last-child td {
            border-bottom: none;
        }

        .odd-value {
            font-weight: 700;
            color: #202733;
        }

        .time-value {
            color: #6b7380;
            font-size: 11px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #6b7380;
        }

        .spinner {
            border: 3px solid #e6ebf0;
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7380;
            font-size: 13px;
        }

        @media (max-width: 1200px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .match-teams {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <header class="ir-header">
        <a href="/" class="ir-logo">INFORADAR.LIVE</a>
        <nav class="ir-nav">
            <a href="/soccer">Soccer</a>
            <a href="/basketball">Basketball</a>
            <a href="/support">Support</a>
            <a href="/faq">FAQ</a>
        </nav>
    </header>

    <div class="container">
        <a href="/prematch" class="back-link">‚Üê Back to Anomalies</a>

        <div class="match-header">
            <div class="match-league">
                <span>üèÜ</span>
                <span id="league-name">{{ league }}</span>
                <span id="match-datetime"></span>
            </div>
            <div class="match-teams" id="match-teams">{{ event_name }}</div>
            <div class="match-progress">
                <div class="match-progress-bar" id="progress-bar" style="width: 10%;">PRE</div>
            </div>
        </div>

        <div class="match-controls">
            <button class="btn-toggle active" id="btn-ft">FT</button>
            <button class="btn-toggle" id="btn-ht">HT</button>
        </div>

        <div id="loading-indicator" class="loading">
            <div class="spinner"></div>
            Loading match data...
        </div>

        <div id="error-container"></div>

        <div id="cards-container" class="cards-grid" style="display: none;">
            <!-- 1X2 Card -->
            <div class="odds-card">
                <div class="odds-card-header">1X2</div>
                <table class="odds-table">
                    <thead>
                        <tr>
                            <th>Game Time</th>
                            <th>Score</th>
                            <th>1</th>
                            <th>X</th>
                            <th>2</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-1x2">
                        <tr>
                            <td colspan="6" class="empty-state">No data</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Handicap Card -->
            <div class="odds-card">
                <div class="odds-card-header">Handicap</div>
                <table class="odds-table">
                    <thead>
                        <tr>
                            <th>Game Time</th>
                            <th>Score</th>
                            <th>Home</th>
                            <th>Handicap</th>
                            <th>Away</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-handicap">
                        <tr>
                            <td colspan="6" class="empty-state">No data</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Total Card -->
            <div class="odds-card">
                <div class="odds-card-header">Total</div>
                <table class="odds-table">
                    <thead>
                        <tr>
                            <th>Game Time</th>
                            <th>Score</th>
                            <th>Over</th>
                            <th>Total</th>
                            <th>Under</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-total">
                        <tr>
                            <td colspan="6" class="empty-state">No data</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const EVENT_NAME = "{{ event_name }}";

        function formatTime(dateStr) {
            if (!dateStr) return '-';
            try {
                const d = new Date(dateStr);
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                const seconds = String(d.getSeconds()).padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            } catch {
                return dateStr;
            }
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return null;
            try {
                const d = new Date(dateStr);
                const day = String(d.getDate()).padStart(2, '0');
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const year = d.getFullYear();
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                return `${day}.${month}.${year} ${hours}:${minutes}`;
            } catch {
                return null;
            }
        }

        async function loadMatchData() {
            try {
                const response = await fetch(`/api/match/${encodeURIComponent(EVENT_NAME)}/full`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to load');
                }

                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('cards-container').style.display = 'grid';

                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–≥—É –∏ –¥–∞—Ç—É
                if (data.league) {
                    document.getElementById('league-name').textContent = data.league;
                }

                if (data.odds && data.odds.length > 0) {
                    const firstRecord = data.odds[0];
                    if (firstRecord.matchtime) {
                        const formatted = formatDateTime(firstRecord.matchtime);
                        if (formatted) {
                            document.getElementById('match-datetime').textContent = formatted;
                        }
                    }
                }

                // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–∞–±–ª–∏—Ü—É 1X2
                if (data.odds && data.odds.length > 0) {
                    render1X2Table(data.odds);
                }

                // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ—Ç–∞–ª—ã –∏ —Ñ–æ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if (data.totals && data.totals.length > 0) {
                    renderTotalTable(data.totals);
                }

                if (data.handicaps && data.handicaps.length > 0) {
                    renderHandicapTable(data.handicaps);
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('error-container').innerHTML = 
                    `<div class="error-box">Failed to load match data: ${error.message}</div>`;
            }
        }

        function render1X2Table(odds) {
            const tbody = document.getElementById('tbody-1x2');
            tbody.innerHTML = '';

            if (odds.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No data</td></tr>';
                return;
            }

            // –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π
            const recent = odds.slice(-10).reverse();

            recent.forEach(record => {
                const row = document.createElement('tr');

                const gameTime = '-';
                const score = '-';
                const odd1 = record.odd1 ? parseFloat(record.odd1).toFixed(2) : '-';
                const oddX = record.oddx ? parseFloat(record.oddx).toFixed(2) : '-';
                const odd2 = record.odd2 ? parseFloat(record.odd2).toFixed(2) : '-';
                const time = formatTime(record.updatedat);

                row.innerHTML = `
                    <td>${gameTime}</td>
                    <td>${score}</td>
                    <td class="odd-value">${odd1}</td>
                    <td class="odd-value">${oddX}</td>
                    <td class="odd-value">${odd2}</td>
                    <td class="time-value">${time}</td>
                `;

                tbody.appendChild(row);
            });
        }

        function renderTotalTable(totals) {
            const tbody = document.getElementById('tbody-total');
            tbody.innerHTML = '';

            if (totals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No data</td></tr>';
                return;
            }

            const recent = totals.slice(-10).reverse();

            recent.forEach(record => {
                const row = document.createElement('tr');

                const over = record.over ? parseFloat(record.over).toFixed(2) : '-';
                const total = record.line || '-';
                const under = record.under ? parseFloat(record.under).toFixed(2) : '-';
                const time = formatTime(record.time || record.updatedat);

                row.innerHTML = `
                    <td>-</td>
                    <td>-</td>
                    <td class="odd-value">${over}</td>
                    <td>${total}</td>
                    <td class="odd-value">${under}</td>
                    <td class="time-value">${time}</td>
                `;

                tbody.appendChild(row);
            });
        }

        function renderHandicapTable(handicaps) {
            const tbody = document.getElementById('tbody-handicap');
            tbody.innerHTML = '';

            if (handicaps.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No data</td></tr>';
                return;
            }

            const recent = handicaps.slice(-10).reverse();

            recent.forEach(record => {
                const row = document.createElement('tr');

                const home = record.home ? parseFloat(record.home).toFixed(2) : '-';
                const handicap = record.handicap || '-';
                const away = record.away ? parseFloat(record.away).toFixed(2) : '-';
                const time = formatTime(record.time || record.updatedat);

                row.innerHTML = `
                    <td>-</td>
                    <td>-</td>
                    <td class="odd-value">${home}</td>
                    <td>${handicap}</td>
                    <td class="odd-value">${away}</td>
                    <td class="time-value">${time}</td>
                `;

                tbody.appendChild(row);
            });
        }

        // –ö–Ω–æ–ø–∫–∏ FT/HT (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π)
        document.getElementById('btn-ft').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('btn-ht').classList.remove('active');
        });

        document.getElementById('btn-ht').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('btn-ft').classList.remove('active');
        });

        loadMatchData();
    </script>
</body>
</html>