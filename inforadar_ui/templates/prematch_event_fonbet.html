{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <h2>Fonbet • Event</h2>
  {% if event %}
    <div class="sub">
      {{ event.league_name or "-" }} •
      <b>{{ event.team1 or "?" }} — {{ event.team2 or "?" }}</b> •
      старт: {{ event.start_time or "-" }}
    </div>
  {% else %}
    <div class="sub">Event ID: {{ request.view_args.event_id }}</div>
  {% endif %}
</div>

<form method="get" class="filters">
  <label>Часы истории:
    <input type="number" name="hours" min="1" max="72" value="{{ hours }}" />
  </label>
  <label>Лимит строк:
    <input type="number" name="limit" min="100" max="5000" value="{{ limit }}" />
  </label>
  <button type="submit">Обновить</button>
  <a class="btn-link" href="/fonbet/">← назад</a>
</form>

<div class="table-wrap">
  <table class="data">
    <thead>
      <tr>
        <th>ts</th>
        <th>factor_id</th>
        <th>odd</th>
        <th>prev</th>
        <th>Δ</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td class="mono">{{ r.ts }}</td>
        <td class="mono">{{ r.factor_id }}</td>
        <td><b>{{ "%.3f"|format(r.odd) if r.odd is not none else "-" }}</b></td>
        <td>{{ "%.3f"|format(r.prev_odd) if r.prev_odd is not none else "-" }}</td>
        <td>
          {% if r.prev_odd is not none and r.odd is not none %}
            {{ "%.3f"|format(r.odd - r.prev_odd) }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      {% if rows|length == 0 %}
      <tr><td colspan="5">Нет изменений за выбранный период</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% endblock %}
