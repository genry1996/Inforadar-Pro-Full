<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ê–Ω–æ–º–∞–ª–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ ‚Äî OddlyOdds Production</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
</head>

<body>
  <!-- ===== –®–∞–ø–∫–∞ ===== -->
  <header>
    <h1>
      ‚öΩ üèÄ üéÆ <span>OddlyOdds <span>Production</span></span>
    </h1>

    <div class="header-right">
      <nav>
        <a href="/" class="{{ 'active' if request.path == '/' else '' }}">Soccer, Live, Matches</a>
        <a href="{{ url_for('anomalies_page') }}"
           class="{{ 'active' if request.path.startswith('/anomalies') else '' }}">–ê–Ω–æ–º–∞–ª–∏–∏</a>
        <a href="#" onclick="return false;">Esports</a>
        <a href="{{ url_for('oddsapi_epl') }}">EPL (Odds API)</a>
      </nav>

      <a href="#" class="telegram-btn">‚úà Telegram</a>

      <select class="lang-select">
        <option value="ru" selected>RU</option>
        <option value="en">EN</option>
      </select>
    </div>
  </header>

  <main>
    <section class="page-section anomalies">
      <h2 class="page-title">‚ö° –ê–Ω–æ–º–∞–ª–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</h2>
      <p class="page-subtitle">
        –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –ª–∏–Ω–∏–π, –ª–∏–º–∏—Ç–æ–≤ –∏ —Ä–∞–∑–±—Ä–æ—Å–æ–≤ –ø–æ –±—É–∫–º–µ–∫–µ—Ä–∞–º.
      </p>

      <!-- –í–∫–ª–∞–¥–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ -->
      <div class="anomaly-tabs">
        <a href="{{ url_for('anomalies_page', type='all') }}"
           class="tab {% if filter_type == 'all' %}active{% endif %}">–í—Å–µ</a>
        <a href="{{ url_for('anomalies_page', type='live') }}"
           class="tab {% if filter_type == 'live' %}active{% endif %}">LIVE</a>
        <a href="{{ url_for('anomalies_page', type='prematch') }}"
           class="tab {% if filter_type == 'prematch' %}active{% endif %}">Prematch</a>
        <a href="{{ url_for('anomalies_page', type='spread') }}"
           class="tab {% if filter_type == 'spread' %}active{% endif %}">–†–∞–∑–±—Ä–æ—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</a>
      </div>

      {% if anomalies %}
        <div class="anomalies-list">
          {% for a in anomalies %}
            {# ===== –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –Ω–∞–¥–ø–∏—Å–∏ ===== #}
            {% set card_type = 'type-default' %}
            {% set type_label = a.anomaly_type %}
            {% if a.anomaly_type == 'ODDS_SPREAD' %}
              {% set card_type = 'type-spread' %}
              {% set type_label = '–†–∞–∑–±—Ä–æ—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤' %}
            {% elif a.anomaly_type in ['ODDS_DROP', 'TEST_DROP'] %}
              {% set card_type = 'type-drop' %}
              {% set type_label = '–ü–∞–¥–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞' %}
            {% elif a.anomaly_type == 'LIMIT_CUT' %}
              {% set card_type = 'type-limit' %}
              {% set type_label = '–ü–æ—Ä–µ–∑–∫–∞ –ª–∏–º–∏—Ç–∞' %}
            {% endif %}

            {# ===== –∑–Ω–∞–∫ –∏ —Ü–≤–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è ===== #}
            {% set diff = a.diff_pct %}
            {% set diff_class = '' %}
            {% if diff is not none %}
              {% if diff < 0 %}
                {% set diff_class = 'negative' %}
              {% elif diff > 0 %}
                {% set diff_class = 'positive' %}
              {% endif %}
            {% endif %}

            <article class="anomaly-card {{ card_type }}">
              <div class="anomaly-card-inner">
                <div class="anomaly-card-header">
                  <div class="anomaly-card-header-left">
                    <div class="anomaly-league-line">
                      {% if a.sport %}
                        <span>{{ a.sport }}</span>
                      {% endif %}
                      {% if a.league %}
                        <span class="dot">‚Ä¢</span>
                        <span>{{ a.league }}</span>
                      {% endif %}
                    </div>

                    <div class="anomaly-teams-line">
                      {% if a.home_team or a.away_team %}
                        {{ a.home_team or '–ö–æ–º–∞–Ω–¥–∞ 1' }}
                        <span class="teams-separator">‚Äî</span>
                        {{ a.away_team or '–ö–æ–º–∞–Ω–¥–∞ 2' }}
                      {% else %}
                        –ú–∞—Ç—á ID {{ a.match_id or a.id }}
                      {% endif %}
                    </div>
                  </div>

                  <div class="anomaly-card-header-right">
                    <div class="anomaly-type-pill">{{ type_label }}</div>
                    <div class="anomaly-time">{{ a.created_at|timeago }}</div>
                  </div>
                </div>

                <div class="anomaly-card-body">
                  <div class="anomaly-odds-row">
                    {% if a.anomaly_type == 'LIMIT_CUT' %}
                      <span class="anomaly-odds-label">–õ–∏–º–∏—Ç:</span>
                    {% else %}
                      <span class="anomaly-odds-label">–ö—ç—Ñ:</span>
                    {% endif %}

                    {% if a.before_value is not none %}
                      <span class="anomaly-odds-from">{{ a.before_value }}</span>
                    {% endif %}

                    {% if a.after_value is not none %}
                      <span class="anomaly-odds-arrow">‚Üí</span>
                      <span class="anomaly-odds-to">{{ a.after_value }}</span>
                    {% endif %}

                    {% if diff is not none %}
                      <span class="anomaly-odds-diff {{ diff_class }}">
                        ({{ "%.2f"|format(diff) }}%)
                      </span>
                    {% endif %}
                  </div>

                  {% if a.comment %}
                    <div class="anomaly-comment">{{ a.comment }}</div>
                  {% endif %}
                </div>

                {% if a.anomaly_type == 'ODDS_SPREAD' %}
                  <div class="anomaly-card-footer">
                    <a href="#" class="anomaly-spread-btn">–†–∞–∑–±—Ä–æ—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</a>
                  </div>
                {% endif %}
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          –ü–æ–∫–∞ –Ω–µ—Ç –∞–Ω–æ–º–∞–ª–∏–π –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä –Ω–∞–π–¥—ë—Ç –¥–≤–∏–∂–µ–Ω–∏–µ –ª–∏–Ω–∏–π ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.
        </div>
      {% endif %}
    </section>
  </main>

  <footer>
    &copy; 2025 OddlyOdds Production. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
  </footer>
</body>
</html>
